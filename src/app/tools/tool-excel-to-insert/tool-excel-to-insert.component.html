
<app-tool-container>
  <app-tool-options>
        
    <!-- Table -->
    <app-option-item>
      <app-option-item-header>
        Table
      </app-option-item-header>
      <app-option-item-content>    
        
        <mat-form-field>
          <mat-label>Table Name</mat-label>
          <input matInput type="text" [(ngModel)]="tableName" (change)="onTableNameChange();" />
        </mat-form-field>

        <mat-slide-toggle color="primary" [(ngModel)]="isCreateTableChecked" (change)="this.onScriptTableChange();">Script Table Create</mat-slide-toggle>
        
        <div *ngIf="this.isCreateTableChecked">
          <mat-form-field>
            <mat-label>Table Name</mat-label>
            <input matInput type="text" [(ngModel)]="tableName" />
          </mat-form-field>
        </div>
      </app-option-item-content>
    </app-option-item>

    <app-option-item *ngIf="this.store.columns$ | async; let columns">
      <app-option-item-header>
        Columns
      </app-option-item-header>
      <app-option-item-content>  

        <mat-table [dataSource]="columns">
          <ng-container matColumnDef="columnName">
            <mat-header-cell *matHeaderCellDef>Column Name</mat-header-cell>
            <mat-cell *matCellDef="let element">{{ element.name }}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="dataType">
            <mat-header-cell *matHeaderCellDef>Data Type</mat-header-cell>
            <mat-cell *matCellDef="let element">
              <mat-select [(value)]="element.dataType">
                <mat-option *ngFor="let dataType of dataTypes" [value]="dataType">{{ dataType }}</mat-option>
              </mat-select>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
        </mat-table>
      
      </app-option-item-content>
    </app-option-item>


    <app-input-excel-paste (contentPasted)="onContentPasted($event)"></app-input-excel-paste>

  </app-tool-options>

  <app-tool-output>
   <ng-container *ngIf="this.store.readyState$ | async; let state">
      <div>INSERT INTO {{state.tableName}}</div>

      <div *ngIf="state.options.contentHasHeader">
        <div>(</div>
        <div *ngFor="let column of state.columns; let i = index;">&#9;[{{ column.name }}]<span *ngIf="i < (state.columns.length - 1)">, </span></div>
        <div>)</div>
      </div>
      <div>VALUES</div>
      <div *ngFor="let row of state.rows; let ri = index;">
        <div>(<span *ngFor="let column of row.columns; let ci = index;">{{column | columnFormat: state.columns[ci].dataType }}<span *ngIf="ci < (row.columns.length - 1)">, </span></span>)<span *ngIf="ri < (row.columns.length - 1)">, </span></div>
      </div>
   </ng-container>
  </app-tool-output>
</app-tool-container>
